{"version":3,"file":"autocomplete.min.js","sources":["../../src/tags/autocomplete.js"],"sourcesContent":["import $ from \"jquery\";\r\nimport Autocomplete from \"theme_dta/form-autocomplete\";\r\nimport {createTags} from \"local_dta/repositories/autocomplete_repository\";\r\nimport Notification from \"core/notification\";\r\n\r\n\r\n/**\r\n * Autocomplete tags.\r\n * @param {HTMLElement} area - The area to autocomplete.\r\n * @return {void}\r\n */\r\nexport function autocompleteTags(area) {\r\n    Autocomplete.enhance(area);\r\n    setDefaultSelectedTags(area);\r\n    area = area.replace(\"#\", \"\");\r\n    document.getElementById(area).addEventListener(\"change\", function(e) {\r\n        handleNewTag(e.target.selectedOptions);\r\n    });\r\n}\r\n\r\n/**\r\n * Set default selected tags.\r\n * @param {*} selector - The selector.\r\n */\r\nfunction setDefaultSelectedTags(selector) {\r\n  var select = $(selector);\r\n  select.find('option[selected]').each(function() {\r\n      select.val($(this).val()).trigger('change');\r\n  });\r\n}\r\n\r\n/**\r\n * Handle new tag.\r\n * @param {Array} selectedOptions - The selected options.\r\n * @return {void}\r\n */\r\nasync function handleNewTag(selectedOptions) {\r\n\r\n    for (var i = 0; i < selectedOptions.length; i++) {\r\n      if (selectedOptions[i].value === \"-1\") {\r\n        selectedOptions[i].label = selectedOptions[i].label.replace(\"Create: \", \"\");\r\n        const {id} = await saveNewTag(selectedOptions[i].label);\r\n        selectedOptions[i].value = parseInt(id);\r\n      }\r\n    }\r\n}\r\n\r\n/**\r\n * Save new tag\r\n * @param {string} tagName - The tag name.\r\n * @return {Promise}\r\n */\r\nasync function saveNewTag(tagName) {\r\n    try {\r\n      return await createTags({\r\n        tag: tagName\r\n      });\r\n    } catch (error) {\r\n      return Notification.exception(error);\r\n    }\r\n}"],"names":["saveNewTag","tagName","tag","error","Notification","exception","area","enhance","selector","select","find","each","val","this","trigger","replace","document","getElementById","addEventListener","e","selectedOptions","i","length","value","label","id","parseInt","handleNewTag","target"],"mappings":"mVAoDeA,WAAWC,0BAEP,uCAAW,CACtBC,IAAKD,UAEP,MAAOE,cACAC,sBAAaC,UAAUF,mGA/CHG,gCAChBC,QAAQD,MAYOE,SAXLF,KAYrBG,QAAS,mBAAED,UACfC,OAAOC,KAAK,oBAAoBC,MAAK,WACjCF,OAAOG,KAAI,mBAAEC,MAAMD,OAAOE,QAAQ,aAbpCR,KAAOA,KAAKS,QAAQ,IAAK,IACzBC,SAASC,eAAeX,MAAMY,iBAAiB,UAAU,SAASC,mBAqB1CC,qBAEnB,IAAIC,EAAI,EAAGA,EAAID,gBAAgBE,OAAQD,OACT,OAA7BD,gBAAgBC,GAAGE,MAAgB,CACrCH,gBAAgBC,GAAGG,MAAQJ,gBAAgBC,GAAGG,MAAMT,QAAQ,WAAY,UAClEU,GAACA,UAAYzB,WAAWoB,gBAAgBC,GAAGG,OACjDJ,gBAAgBC,GAAGE,MAAQG,SAASD,KA1BpCE,CAAaR,EAAES,OAAOR,wBAQEZ,SAC1BC"}