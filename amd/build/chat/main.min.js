define("local_dta/chat/main",["exports","jquery","core/templates","core/notification","./selectors","local_dta/repositories/chat_repository","./listeners"],(function(_exports,_jquery,_templates,_notification,_selectors,_chat_repository,_listeners){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function(target){return _selectors.default.TARGET=target,void initComponent()},_exports.handleSendMessage=async function(){const message=(0,_jquery.default)(_selectors.default.INPUTS.CHAT_REPLY).val().trim();return void(0,_chat_repository.sendMessage)({chatid:_selectors.default.OPEN_CHAT_ID,message:message}).then((()=>{(0,_jquery.default)(_selectors.default.INPUTS.CHAT_REPLY).val(""),async function(message){const date=(new Date).toLocaleTimeString("es-ES",{hour12:!1,hour:"2-digit",minute:"2-digit"}),html=await renderMessage(message,date,!0);(0,_jquery.default)(_selectors.default.CONTAINERS.MESSAGES).append(html)}(message)})).fail(_notification.default.exception)},_exports.handlerMessages=handlerMessages,_exports.renderChat=async function(id){const{messages:messages}=await(0,_chat_repository.getMessages)({chatid:id});_selectors.default.OPEN_CHAT_ID=id,_templates.default.render(_selectors.default.TEMPLATES.CHAT,{SELECTORS:_selectors.default}).then((html=>{(0,_jquery.default)(_selectors.default.TARGET).html(html),handlerMessages(messages)})).fail(_notification.default.exception)},_exports.renderMenuChat=renderMenuChat,_exports.renderMessage=renderMessage,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_selectors=_interopRequireDefault(_selectors),_listeners=_interopRequireDefault(_listeners);const initComponent=()=>{(0,_listeners.default)(),renderMenuChat()};async function renderMenuChat(){const{chatrooms:chatrooms}=await(0,_chat_repository.getChatRooms)();_templates.default.render(_selectors.default.TEMPLATES.MENU_CHAT,{chatrooms:chatrooms}).then((html=>{(0,_jquery.default)(_selectors.default.TARGET).html(html)})).fail(_notification.default.exception)}async function handlerMessages(messages){let html="";const promises=messages.map((msg=>{const{message:message,timecreated:timecreated,is_mine:is_mine}=msg;return renderMessage(message,timecreated,is_mine)}));try{html=(await Promise.all(promises)).join("")}catch(error){_notification.default.exception(error)}(0,_jquery.default)(_selectors.default.CONTAINERS.MESSAGES).html(html)}async function renderMessage(text,time,mine){const TEMPLATE=mine?_selectors.default.TEMPLATES.MY_MESSAGE:_selectors.default.TEMPLATES.OTHER_MESSAGE;return _templates.default.render(TEMPLATE,{text:text,time:time})}return _exports.default}));

//# sourceMappingURL=main.min.js.map