{"version":3,"file":"main.min.js","sources":["../../src/chat/main.js"],"sourcesContent":["import $ from 'jquery';\r\nimport Template from 'core/templates';\r\nimport Notification from 'core/notification';\r\nimport SELECTORS from './selectors';\r\nimport { getChatRooms, sendMessage, getMessages } from 'local_dta/repositories/chat_repository';\r\nimport setEventListeners from './listeners';\r\n\r\n\r\n/**\r\n * Create a chat in the target\r\n * @param {string} target\r\n */\r\nexport default function createChatInTarget(target) {\r\n    SELECTORS.TARGET = target;\r\n    initComponent();\r\n    return;\r\n}\r\n\r\n// Initialize the component\r\nconst initComponent = () => {\r\n    setEventListeners();\r\n    renderMenuChat();\r\n};\r\n\r\n/**\r\n * Render menu chat\r\n */\r\nexport async function renderMenuChat() {\r\n    const { chatrooms } = await getChatRooms();\r\n    Template.render(SELECTORS.TEMPLATES.MENU_CHAT, {\r\n        chatrooms\r\n    }).then((html) => {\r\n        $(SELECTORS.TARGET).html(html);\r\n        return;\r\n    }).fail(Notification.exception);\r\n}\r\n\r\n/**\r\n * Open chat\r\n * @param {number} id\r\n * Render chat\r\n */\r\nexport async function renderChat(id) {\r\n    const {messages} = await getMessages({ chatid: id });\r\n    SELECTORS.OPEN_CHAT_ID = id;\r\n    Template.render(SELECTORS.TEMPLATES.CHAT, {\r\n        SELECTORS\r\n    }).then((html) => {\r\n        $(SELECTORS.TARGET).html(html);\r\n        handlerMessages(messages);\r\n        return;\r\n    }).fail(Notification.exception);\r\n}\r\n\r\n\r\n/**\r\n * Render messages in chat\r\n * @param {Array} messages\r\n */\r\nexport async function handlerMessages(messages) {\r\n    let html = '';\r\n    const promises = messages.map((msg) => {\r\n        const {message, timecreated, is_mine} = msg;\r\n        return renderMessage(message, timecreated, is_mine);\r\n    });\r\n    try {\r\n        html = (await Promise.all(promises)).join('');\r\n    } catch (error) {\r\n        Notification.exception(error);\r\n    }\r\n    $(SELECTORS.CONTAINERS.MESSAGES).html(html);\r\n}\r\n\r\n/**\r\n * Render my message\r\n * @param {string} text\r\n * @param {string} time\r\n * @param {boolean} mine\r\n * @returns {Promise}\r\n */\r\nexport async function renderMessage(text, time, mine) {\r\n    const TEMPLATE = mine ? SELECTORS.TEMPLATES.MY_MESSAGE : SELECTORS.TEMPLATES.OTHER_MESSAGE;\r\n    return Template.render(TEMPLATE, { text, time });\r\n}\r\n\r\n/**\r\n * Handle send message\r\n * @returns {Promise}\r\n */\r\nexport async function handleSendMessage() {\r\n    const message = $(SELECTORS.INPUTS.CHAT_REPLY).val().trim();\r\n    sendMessage({\r\n        chatid: SELECTORS.OPEN_CHAT_ID,\r\n        message,\r\n    }).then(() => {\r\n        $(SELECTORS.INPUTS.CHAT_REPLY).val('');\r\n        renderChat(SELECTORS.OPEN_CHAT_ID);\r\n        return;\r\n    }).fail(Notification.exception);\r\n\r\n    return;\r\n}"],"names":["target","TARGET","initComponent","message","SELECTORS","INPUTS","CHAT_REPLY","val","trim","chatid","OPEN_CHAT_ID","then","renderChat","fail","Notification","exception","renderMenuChat","chatrooms","render","TEMPLATES","MENU_CHAT","html","id","messages","CHAT","handlerMessages","promises","map","msg","timecreated","is_mine","renderMessage","Promise","all","join","error","CONTAINERS","MESSAGES","text","time","mine","TEMPLATE","MY_MESSAGE","OTHER_MESSAGE","Template"],"mappings":"4ZAY2CA,kCAC7BC,OAASD,YACnBE,mEA4EMC,SAAU,mBAAEC,mBAAUC,OAAOC,YAAYC,MAAMC,mDACzC,CACRC,OAAQL,mBAAUM,aAClBP,QAAAA,UACDQ,MAAK,yBACFP,mBAAUC,OAAOC,YAAYC,IAAI,IACnCK,WAAWR,mBAAUM,iBAEtBG,KAAKC,sBAAaC,4YA/EnBb,cAAgB,8BAElBc,iCAMkBA,uBACZC,UAAEA,iBAAoB,sDACnBC,OAAOd,mBAAUe,UAAUC,UAAW,CAC3CH,UAAAA,YACDN,MAAMU,2BACHjB,mBAAUH,QAAQoB,KAAKA,SAE1BR,KAAKC,sBAAaC,0BAQHH,WAAWU,UACvBC,SAACA,gBAAkB,gCAAY,CAAEd,OAAQa,wBACrCZ,aAAeY,sBAChBJ,OAAOd,mBAAUe,UAAUK,KAAM,CACtCpB,UAAAA,qBACDO,MAAMU,2BACHjB,mBAAUH,QAAQoB,KAAKA,MACzBI,gBAAgBF,aAEjBV,KAAKC,sBAAaC,0BAQHU,gBAAgBF,cAC9BF,KAAO,SACLK,SAAWH,SAASI,KAAKC,YACrBzB,QAACA,QAAD0B,YAAUA,YAAVC,QAAuBA,SAAWF,WACjCG,cAAc5B,QAAS0B,YAAaC,gBAG3CT,YAAcW,QAAQC,IAAIP,WAAWQ,KAAK,IAC5C,MAAOC,6BACQpB,UAAUoB,2BAEzB/B,mBAAUgC,WAAWC,UAAUhB,KAAKA,qBAUpBU,cAAcO,KAAMC,KAAMC,YACtCC,SAAWD,KAAOpC,mBAAUe,UAAUuB,WAAatC,mBAAUe,UAAUwB,qBACtEC,mBAAS1B,OAAOuB,SAAU,CAAEH,KAAAA,KAAMC,KAAAA"}