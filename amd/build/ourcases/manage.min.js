define("local_dta/ourcases/manage",["exports","jquery","core/templates","core/notification","local_dta/repositories/ourcasesRepository","core/modal_factory","core/str","editor_tiny/loader"],(function(_exports,_jquery,_templates,_notification,_ourcasesRepository,_modal_factory,_str,_loader){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}let sectionTextModal,tinymce;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory);let urlView=null;function changeSectionHeaderToEdit(){let toView=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const id=(0,_jquery.default)("#section-header-id").val(),title=(0,_jquery.default)("#section-header-title").val(),description=toView?(0,_jquery.default)("#section-header-description").val():getTinyMCEContent("section-header-description"),template=toView?"local_dta/cases/section-header-edit":"local_dta/cases/section-header-view";_templates.default.render(template,{sectionheader:{id:id,title:title,description:description}}).then((html=>(0,_jquery.default)("#sections-header").html(html))).fail(_notification.default.exception)}function changeSectionToEdit(){let toView=arguments.length>0&&void 0!==arguments[0]&&arguments[0],id=arguments.length>1?arguments[1]:void 0;const description=toView?(0,_jquery.default)("#content_".concat(id)).html():(0,_jquery.default)("#content_".concat(id)).val(),template=toView?"local_dta/cases/section-text-edit":"local_dta/cases/section-text-view";_templates.default.render(template,{id:id,description:description}).then((html=>(0,_jquery.default)("#section_".concat(id)).replaceWith(html))).fail(_notification.default.exception)}function upsertSection(id){const sectionid=(0,_jquery.default)("#not_exist_".concat(id)).val()?null:(0,_jquery.default)("#sectionid_".concat(id)).val(),ourcaseid=(0,_jquery.default)("#ourcases-id").val(),text=(0,_jquery.default)("#content_".concat(id)).val();return(0,_ourcasesRepository.sectionTextUpsert)({ourcaseid:ourcaseid,sectionid:sectionid,title:null,text:text,sequence:-1}).then((data=>{if(data&&data.result)return function(id,toId){const description=(0,_jquery.default)("#content_".concat(id)).val();_templates.default.render("local_dta/cases/section-text-view",{id:toId,description:description,exist:!0}).then((html=>(0,_jquery.default)("#section_".concat(id)).replaceWith(html))).fail(_notification.default.exception)}(id,data.sectionid),data;throw new Error("No se pudo realizar la actualización de la sección.")})).fail((()=>{throw new Error("Hubo un error al realizar la solicitud: ")}))}function removeTinyMCEFromArea(area){tinymce.get(area).remove()}function getTinyMCEContent(area){return tinymce.get(area).getContent()}function createTinyMCE(area){setTimeout((()=>{tinymce.init({selector:"textarea#".concat(area),plugins:"image , table"})}),200)}function setEventListeners(){(0,_jquery.default)(document).on("click","#add-section",(()=>{_templates.default.render("local_dta/cases/section-text-edit",{id:(new Date).getTime(),description:null,exist:!0}).then((html=>{(0,_jquery.default)("#sections-body").append(html),createTinyMCE((0,_jquery.default)(".card-body:has(textarea)").last().find("textarea").attr("id")),window.scrollTo(0,document.body.scrollHeight)})).fail(_notification.default.exception)})),(0,_jquery.default)(document).on("click","#header-edit-button",(()=>{!function(){const sectionid=(0,_jquery.default)("#section-header-id").val(),ourcaseid=(0,_jquery.default)("#ourcases-id").val(),title=(0,_jquery.default)("#section-header-title").val(),text=getTinyMCEContent("section-header-description");(0,_ourcasesRepository.sectionTextUpsert)({ourcaseid:ourcaseid,sectionid:sectionid,title:title,text:text,sequence:0}),changeSectionHeaderToEdit(),removeTinyMCEFromArea("section-header-description")}()})),(0,_jquery.default)(document).on("click","#header-to-edit-button",(()=>{changeSectionHeaderToEdit(!0),createTinyMCE("section-header-description")})),(0,_jquery.default)(document).on("click","#header-edit-close-button",(()=>{changeSectionHeaderToEdit(),removeTinyMCEFromArea("section-header-description")})),(0,_jquery.default)(document).on("click",".section-close-button",(function(){const id=(0,_jquery.default)(this).data("id");var sectionid;sectionid=id,(0,_jquery.default)("#not_exist_".concat(sectionid)).val()?sectionid&&(0,_jquery.default)("#section_".concat(sectionid)).remove():changeSectionToEdit(!1,sectionid),removeTinyMCEFromArea("content_".concat(id))})),(0,_jquery.default)(document).on("click",".section-edit-button",(function(){const id=(0,_jquery.default)(this).data("id");upsertSection(id),removeTinyMCEFromArea("content_".concat(id))})),(0,_jquery.default)(document).on("click",".section-to-edit-button",(function(){changeSectionToEdit(!0,(0,_jquery.default)(this).data("id"));const id=(0,_jquery.default)(this).data("id");createTinyMCE("content_".concat(id))})),(0,_jquery.default)(document).on("click",".section-delete-button",(function(){!async function(sectionid){sectionTextModal=await _modal_factory.default.create({title:(0,_str.get_string)("ourcases_section_text_delete_modal_title","local_dta"),body:_templates.default.render("local_dta/cases/section-text-modal",{modalDeleteId:sectionid})}),(0,_jquery.default)("#modal_delete_id").val(),sectionTextModal.show()}((0,_jquery.default)(this).data("id"))})),(0,_jquery.default)(document).on("click","#confirmDelete",(function(){!function(){const sectionid=(0,_jquery.default)("#modal_delete_id").val(),ourcaseid=(0,_jquery.default)("#ourcases-id").val();(0,_ourcasesRepository.sectionTextDelete)({ourcaseid:ourcaseid,sectionid:sectionid}).then((data=>{data.result&&(sectionTextModal.hide(),sectionTextModal=null,(0,_jquery.default)("#section_".concat(sectionid)).remove())})).fail(_notification.default.exception)}()})),(0,_jquery.default)(document).on("click","#save-case-button",(function(){!async function(){const button=(0,_jquery.default)("#header-edit-button")[0],button2=(0,_jquery.default)("#section-edit-button")[0];(await _modal_factory.default.create({title:(0,_str.get_string)("ourcases_modal_save_title","local_dta"),body:_templates.default.render("local_dta/cases/manage-save-modal",{havePendingChanges:!(!button&&!button2)})})).show()}()})),(0,_jquery.default)(document).on("click","#complete-case-button",(function(){!function(){const args={ourcaseid:(0,_jquery.default)("#ourcases-id").val(),status:1};(0,_ourcasesRepository.ourcaseEdit)(args).then((data=>{data.result&&(window.location.href=urlView)})).fail(_notification.default.exception)}()}))}_exports.init=async urlRepository=>{setEventListeners(),tinymce=await(0,_loader.getTinyMCE)(),createTinyMCE("section-header-description"),urlView=urlRepository}}));

//# sourceMappingURL=manage.min.js.map