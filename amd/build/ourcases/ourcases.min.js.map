{"version":3,"file":"ourcases.min.js","sources":["../../src/ourcases/ourcases.js"],"sourcesContent":["import $ from 'jquery';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\nimport {sectionTextUpsert} from 'local_dta/repositories/ourcasesRepository';\r\n\r\n\r\n/**\r\n * Add a new text section to the page.\r\n * @return {void}\r\n */\r\nfunction addTextSection() {\r\n    Templates.render('local_dta/ourcases/section-text-edit', {\r\n        id: new Date().getTime(),\r\n        description: null,\r\n        exist: true\r\n    }).then((html) => {\r\n        return $('#sections-body').append(html);\r\n    }).fail(Notification.exception);\r\n}\r\n\r\n/**\r\n * Upsert a text section.\r\n * @param {object} args - The arguments for the function.\r\n */\r\nfunction upsertText(args) {\r\n    sectionTextUpsert(args).then((data) => {\r\n        return data;\r\n    }).fail(Notification.exception);\r\n}\r\n\r\n/**\r\n * Change the section to edit mode.\r\n * @param {boolean} toView - Whether to change to view mode.\r\n * @return {void}\r\n * */\r\nfunction changeSectionHeaderToEdit(toView = false) {\r\n    const sectionid = $('#section-header-id').val();\r\n    const title = $('#section-header-title').val();\r\n    const description = $('#section-header-description').val();\r\n    const template = toView ? 'local_dta/ourcases/section-header-edit' : 'local_dta/ourcases/section-header-view';\r\n    Templates.render(template,\r\n     {sectionheader: {id: sectionid, title, description}}).then((html) => {\r\n        return $('#sections-header').html(html);\r\n    }).fail(Notification.exception);\r\n}\r\n\r\n\r\n/**\r\n * Change the section to edit mode.\r\n * @param {boolean} toView - Whether to change to view mode.\r\n * @param {number} id - The id of the section to change.\r\n * @return {void}\r\n * */\r\nfunction changeSectionToEdit(toView = false, id) {\r\n    const description = $(`#content_${id}`).val();\r\n    const template = toView ? 'local_dta/ourcases/section-text-edit' : 'local_dta/ourcases/section-text-view';\r\n    Templates.render(template,\r\n     {id, description}).then((html) => {\r\n        return $(`#section_${id}`).replaceWith(html);\r\n    }).fail(Notification.exception);\r\n}\r\n\r\n\r\n/**\r\n * Set event listeners for the module.\r\n * @return {void}\r\n *\r\n */\r\nfunction upsertHeaderSection() {\r\n    const sectionid = $('#section-header-id').val();\r\n    const ourcaseid = $('#ourcases-id').val();\r\n    const title = $('#section-header-title').val();\r\n    const text = $('#section-header-description').val();\r\n    const sequence = 0;\r\n    upsertText({ourcaseid, sectionid, title, text, sequence});\r\n    changeSectionHeaderToEdit();\r\n}\r\n\r\n/**\r\n * Set event listeners for the module.\r\n * @param {number} id - The id of the section to remove.\r\n * @return {void}\r\n *\r\n */\r\nfunction upsertSection(id) {\r\n    const sectionid = $(`#not_exist_${id}`).val() ? null : $(`#sectionid_${id}`).val();\r\n    const ourcaseid = $('#ourcases-id').val();\r\n    const title = null;\r\n    const text = $(`#content_${id}`).val();\r\n    const sequence = -1;\r\n    upsertText({ourcaseid, sectionid, title, text, sequence});\r\n    changeSectionToEdit(false, id);\r\n    $(`#not_exist_${id}`).val(false);\r\n}\r\n\r\n/**\r\n * Remove a section from the page.\r\n * @param {number} sectionid - The id of the section to remove.\r\n * @return {void}\r\n */\r\nfunction removeSection(sectionid) {\r\n    if (sectionid) {\r\n        $(`#section_${sectionid}`).remove();\r\n    }\r\n}\r\n\r\n/**\r\n * Set event listeners for the module.\r\n * @return {void}\r\n * */\r\nfunction setEventListeners() {\r\n    // Add a new text section\r\n    $(document).on('click', '#add-section', () => {\r\n        addTextSection();\r\n    });\r\n    // Edit the header\r\n    $(document).on('click', '#header-edit-button', () => {\r\n        upsertHeaderSection();\r\n    });\r\n    // Change the header section to edit mode\r\n    $(document).on('click', '#header-to-edit-button', () => {\r\n        changeSectionHeaderToEdit(true);\r\n    });\r\n    // Change the header section to view mode withour editing\r\n    $(document).on('click', '#header-edit-close-button', () => {\r\n        changeSectionHeaderToEdit();\r\n    });\r\n    // Remove a section\r\n    $(document).on('click', '.section-close-button', function() {\r\n        removeSection($(this).data('id'));\r\n    });\r\n    // Edit the section\r\n    $(document).on('click', '.section-edit-button', function() {\r\n        upsertSection($(this).data('id'));\r\n    });\r\n    // Change the section to edit mode\r\n    $(document).on('click', '.section-to-edit-button', function() {\r\n        changeSectionToEdit(true, $(this).data('id'));\r\n    });\r\n}\r\n\r\n\r\n/**\r\n * Initialize the module.\r\n * @return {void}\r\n */\r\nexport const init = () => {\r\n    setEventListeners();\r\n};"],"names":["upsertText","args","then","data","fail","Notification","exception","changeSectionHeaderToEdit","toView","sectionid","val","title","description","template","render","sectionheader","id","html","changeSectionToEdit","replaceWith","setEventListeners","document","on","Date","getTime","exist","append","ourcaseid","text","sequence","upsertHeaderSection","this","remove","upsertSection"],"mappings":"+SAwBSA,WAAWC,gDACEA,MAAMC,MAAMC,MACnBA,OACRC,KAAKC,sBAAaC,oBAQhBC,gCAA0BC,qEACzBC,WAAY,mBAAE,sBAAsBC,MACpCC,OAAQ,mBAAE,yBAAyBD,MACnCE,aAAc,mBAAE,+BAA+BF,MAC/CG,SAAWL,OAAS,yCAA2C,4DAC3DM,OAAOD,SAChB,CAACE,cAAe,CAACC,GAAIP,UAAWE,MAAAA,MAAOC,YAAAA,eAAeV,MAAMe,OAClD,mBAAE,oBAAoBA,KAAKA,QACnCb,KAAKC,sBAAaC,oBAUhBY,0BAAoBV,+DAAgBQ,gDACnCJ,aAAc,sCAAcI,KAAMN,MAClCG,SAAWL,OAAS,uCAAyC,0DACzDM,OAAOD,SAChB,CAACG,GAAAA,GAAIJ,YAAAA,cAAcV,MAAMe,OACf,sCAAcD,KAAMG,YAAYF,QACxCb,KAAKC,sBAAaC,oBAmDhBc,wCAEHC,UAAUC,GAAG,QAAS,gBAAgB,wBArG9BR,OAAO,uCAAwC,CACrDE,IAAI,IAAIO,MAAOC,UACfZ,YAAa,KACba,OAAO,IACRvB,MAAMe,OACE,mBAAE,kBAAkBS,OAAOT,QACnCb,KAAKC,sBAAaC,kCAmGnBe,UAAUC,GAAG,QAAS,uBAAuB,uBA/CzCb,WAAY,mBAAE,sBAAsBC,MAK1CV,WAAW,CAAC2B,WAJM,mBAAE,gBAAgBjB,MAIbD,UAAAA,UAAWE,OAHpB,mBAAE,yBAAyBD,MAGAkB,MAF5B,mBAAE,+BAA+BlB,MAECmB,SAD9B,IAEjBtB,4BA0CIuB,0BAGFT,UAAUC,GAAG,QAAS,0BAA0B,KAC9Cf,2BAA0B,0BAG5Bc,UAAUC,GAAG,QAAS,6BAA6B,KACjDf,mDAGFc,UAAUC,GAAG,QAAS,yBAAyB,eA5B9Bb,WAAAA,WA6BD,mBAAEsB,MAAM5B,KAAK,+CA3BbM,YAAauB,gCA8B7BX,UAAUC,GAAG,QAAS,wBAAwB,qBAhD7BN,UACbP,WAAY,wCAAgBO,KAAMN,MAAQ,MAAO,wCAAgBM,KAAMN,MAK7EV,WAAW,CAAC2B,WAJM,mBAAE,gBAAgBjB,MAIbD,UAAAA,UAAWE,MAHpB,KAG2BiB,MAF5B,sCAAcZ,KAAMN,MAEcmB,UAD7B,IAElBX,qBAAoB,EAAOF,6CACXA,KAAMN,KAAI,GAyCtBuB,EAAc,mBAAEF,MAAM5B,KAAK,8BAG7BkB,UAAUC,GAAG,QAAS,2BAA2B,WAC/CJ,qBAAoB,GAAM,mBAAEa,MAAM5B,KAAK,+OAS3B,KAChBiB"}