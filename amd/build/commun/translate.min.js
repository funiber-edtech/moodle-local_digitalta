define("local_digitalta/commun/translate",["exports","local_digitalta/repositories/translation_repository","core/str"],(function(_exports,_translation_repository,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.translateButton=void 0,Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);_exports.translateButton=()=>{const translateButton=document.querySelector(".translate-action");if(!translateButton)return;const translatableContent=document.querySelectorAll(".translatable-content"),translatedButtonIcon=translateButton.querySelector("i");translateButton.addEventListener("click",(async()=>{if("true"===translateButton.dataset.translated){translatableContent.forEach((content=>{content.classList.remove("d-none")}));document.querySelectorAll(".translated-content").forEach((content=>{content.remove()})),translateButton.dataset.translated="false",translateButton.innerHTML=await Str.get_string("seetranslation","local_digitalta"),translateButton.insertAdjacentElement("beforeend",translatedButtonIcon)}else{const promises=[];for(const content of translatableContent){const{response:response}=await(0,_translation_repository.translateContent)({text:content.innerHTML.trim()});promises.push(createElementPromise(content,response))}await Promise.all(promises),translateButton.dataset.translated="true",translateButton.innerHTML=await Str.get_string("seeoriginal","local_digitalta"),translateButton.insertAdjacentElement("beforeend",translatedButtonIcon)}}))};const createElementPromise=(translatableContent,text)=>new Promise((resolve=>{const newElement=document.createElement(translatableContent.tagName.toLowerCase());newElement.classList.add("translated-content"),newElement.innerHTML=text,translatableContent.classList.add("d-none"),translatableContent.insertAdjacentElement("afterend",newElement),resolve()}))}));

//# sourceMappingURL=translate.min.js.map