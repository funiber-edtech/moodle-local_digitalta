{"version":3,"file":"manage_resources.min.js","sources":["../../src/resources/manage_resources.js"],"sourcesContent":["import ModalFactory from \"core/modal_factory\";\nimport addResourceModal from \"local_dta/resources/add_resource_modal\";\nimport { displaylinkResourcesModal } from \"local_dta/experiences/modals\";\nimport ModalEvents from \"core/modal_events\";\nimport { getList } from \"core/normalise\";\nimport { resourcesUpsert } from \"local_dta/repositories/resources_repository\";\nimport Notification from \"core/notification\";\n\n/**\n * Handle the submission of the dialogue.\n *\n * @param {Event} event\n * @param {Modal} modal\n */\nconst handleDialogueSubmission = async (event, modal) => {\n    const form = getList(modal.getRoot())[0].querySelector(\"form\");\n\n    if (!form) {\n        return;\n    }\n    const formData = {\n        id: 0,\n        name: form.querySelector('input[name=\"nameInput\"]').value,\n        path: form.querySelector('input[name=\"urlInput\"]').value,\n        description: form.querySelector('textarea[name=\"descriptionInput\"]').value,\n        themes: Array.from(\n            form.querySelectorAll('select[name=\"themeSelect\"] option:checked'),\n            option => option.value),\n        tags: Array.from(\n            form.querySelectorAll('select[name=\"tagSelect\"] option:checked'),\n            option => option.value),\n        type: form.querySelector('select[name=\"typeSelect\"]').value,\n        format: form.querySelector('input[name=\"formatInput\"]').value,\n        lang: form.querySelector('select[name=\"languageSelect\"]').value,\n    };\n\n    try {\n        await resourcesUpsert(formData);\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n\n/**\n * Display the dialogue.\n *\n * @param {Object} options\n */\nexport const displayDialogue = async (options) => {\n    const languages = [\n        { value: 'es', text: 'Spanish' },\n        { value: 'en', text: 'English' }\n    ];\n\n    const modal = await ModalFactory.create({\n        type: addResourceModal.TYPE,\n        templateContext: {\n            elementid_: Date.now(),\n            themes: options.themes,\n            tags: options.tags,\n            types: options.types,\n            format_input_id: options.format_id,\n            languages: languages,\n            change: options.change\n        },\n        large: true,\n    });\n    modal.show();\n    const $root = modal.getRoot();\n    if (options.change) {\n        const changeElement = $root.find(\"#changeToImportResource\").get(0);\n        if (changeElement) {\n            changeElement.onclick = () => {\n                displaylinkResourcesModal(true);\n                modal.hide();\n            };\n        }\n    }\n\n    $root.on(ModalEvents.save, (event, modal) => {\n        handleDialogueSubmission(event, modal);\n    });\n};\n\n/**\n * Initialise the module.\n *\n * @param {Object} options\n */\nexport const init = (options) => {\n    if (typeof options.change === 'undefined') {\n        options.change = false;\n    }\n    document.getElementById(\"addResourceButton\").addEventListener(\"click\", () => displayDialogue(options));\n};\n"],"names":["displayDialogue","async","modal","ModalFactory","create","type","addResourceModal","TYPE","templateContext","elementid_","Date","now","themes","options","tags","types","format_input_id","format_id","languages","value","text","change","large","show","$root","getRoot","changeElement","find","get","onclick","hide","on","ModalEvents","save","event","form","querySelector","formData","id","name","path","description","Array","from","querySelectorAll","option","format","lang","error","exception","handleDialogueSubmission","document","getElementById","addEventListener"],"mappings":"sxBAgDaA,gBAAkBC,MAAAA,gBAMrBC,YAAcC,uBAAaC,OAAO,CACpCC,KAAMC,4BAAiBC,KACvBC,gBAAiB,CACbC,WAAYC,KAAKC,MACjBC,OAAQC,QAAQD,OAChBE,KAAMD,QAAQC,KACdC,MAAOF,QAAQE,MACfC,gBAAiBH,QAAQI,UACzBC,UAbU,CACd,CAAEC,MAAO,KAAMC,KAAM,WACrB,CAAED,MAAO,KAAMC,KAAM,YAYjBC,OAAQR,QAAQQ,QAEpBC,OAAO,IAEXpB,MAAMqB,aACAC,MAAQtB,MAAMuB,aAChBZ,QAAQQ,OAAQ,OACVK,cAAgBF,MAAMG,KAAK,2BAA2BC,IAAI,GAC5DF,gBACAA,cAAcG,QAAU,4CACM,GAC1B3B,MAAM4B,SAKlBN,MAAMO,GAAGC,sBAAYC,MAAM,CAACC,MAAOhC,SAjEND,OAAOiC,MAAOhC,eACrCiC,MAAO,sBAAQjC,MAAMuB,WAAW,GAAGW,cAAc,YAElDD,kBAGCE,SAAW,CACbC,GAAI,EACJC,KAAMJ,KAAKC,cAAc,2BAA2BjB,MACpDqB,KAAML,KAAKC,cAAc,0BAA0BjB,MACnDsB,YAAaN,KAAKC,cAAc,qCAAqCjB,MACrEP,OAAQ8B,MAAMC,KACVR,KAAKS,iBAAiB,8CACtBC,QAAUA,OAAO1B,QACrBL,KAAM4B,MAAMC,KACRR,KAAKS,iBAAiB,4CACtBC,QAAUA,OAAO1B,QACrBd,KAAM8B,KAAKC,cAAc,6BAA6BjB,MACtD2B,OAAQX,KAAKC,cAAc,6BAA6BjB,MACxD4B,KAAMZ,KAAKC,cAAc,iCAAiCjB,iBAIpD,yCAAgBkB,UACxB,MAAOW,6BACQC,UAAUD,SAyCvBE,CAAyBhB,EAAOhC,kEASnBW,eACa,IAAnBA,QAAQQ,SACfR,QAAQQ,QAAS,GAErB8B,SAASC,eAAe,qBAAqBC,iBAAiB,SAAS,IAAMrD,gBAAgBa"}