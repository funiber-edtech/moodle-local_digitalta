{"version":3,"file":"comments.min.js","sources":["../../src/reactions/comments.js"],"sourcesContent":["import $ from \"jquery\";\nimport Template from \"core/templates\";\nimport Notification from \"core/notification\";\nimport { SELECTORS } from \"./selectors\";\nimport { saveComment, getComments } from \"../repositories/reactions_repository\";\n\n/**\n * Send the comment to the server.\n * @return {void}\n */\nexport function sendComment() {\n  const comment = $(SELECTORS.COMMENT_INPUT).val().trim();\n  const instanceid = $(SELECTORS.ACTIONS.sendComment).data(\"id\");\n  const instancetype = $(SELECTORS.BUTTONS.comment).data(\"instance\");\n\n  if (comment) {\n    saveComment({ instancetype, instanceid, comment })\n      .then((response) => {\n        if (response.result) {\n          return updateUI();\n        }\n        return Notification.exception(response);\n      })\n      .fail(Notification.exception);\n    $(SELECTORS.COMMENT_INPUT).val(\"\");\n  }\n}\n\n/**\n * Update the comments in the UI.\n * @return {void}\n */\nexport async function updateUI() {\n  const instanceid = $(SELECTORS.ACTIONS.sendComment).data(\"id\");\n  const instancetype = $(SELECTORS.BUTTONS.comment).data(\"instance\");\n  if (!instanceid) {\n    return;\n  }\n\n  try {\n    const response = await getComments({ instanceid, instancetype });\n    const comments = response.comments.map((comment) => ({\n      comment: comment.comment,\n      userfullname: comment.user.fullname,\n      userprofileurl: M.cfg.wwwroot + \"/user/profile.php?id=\" + comment.user.id,\n    }));\n\n    const html = await Template.render(\"local_dta/reactions/comments\", { comments });\n    $(SELECTORS.COMMENTS_LIST).html(html);\n\n    $(SELECTORS.ACTIONS.viewComment + SELECTORS.DATA.id(instanceid) + \" span\").text(\n      response.comments.length ? response.comments.length : \"\"\n    );\n  } catch (error) {\n    Notification.exception(error);\n  }\n}\n"],"names":["updateUI","instanceid","SELECTORS","ACTIONS","sendComment","data","instancetype","BUTTONS","comment","response","comments","map","userfullname","user","fullname","userprofileurl","M","cfg","wwwroot","id","html","Template","render","COMMENTS_LIST","viewComment","DATA","text","length","error","exception","COMMENT_INPUT","val","trim","then","result","Notification","fail"],"mappings":"4UAgCsBA,iBACdC,YAAa,mBAAEC,qBAAUC,QAAQC,aAAaC,KAAK,MACnDC,cAAe,mBAAEJ,qBAAUK,QAAQC,SAASH,KAAK,eAClDJ,qBAKGQ,eAAiB,qCAAY,CAAER,WAAAA,WAAYK,aAAAA,eAC3CI,SAAWD,SAASC,SAASC,KAAKH,WACtCA,QAASA,QAAQA,QACjBI,aAAcJ,QAAQK,KAAKC,SAC3BC,eAAgBC,EAAEC,IAAIC,QAAU,wBAA0BV,QAAQK,KAAKM,OAGnEC,WAAaC,mBAASC,OAAO,+BAAgC,CAAEZ,SAAAA,+BACnER,qBAAUqB,eAAeH,KAAKA,0BAE9BlB,qBAAUC,QAAQqB,YAActB,qBAAUuB,KAAKN,GAAGlB,YAAc,SAASyB,KACzEjB,SAASC,SAASiB,OAASlB,SAASC,SAASiB,OAAS,IAExD,MAAOC,6BACMC,UAAUD,sGA3CnBpB,SAAU,mBAAEN,qBAAU4B,eAAeC,MAAMC,OAC3C/B,YAAa,mBAAEC,qBAAUC,QAAQC,aAAaC,KAAK,MACnDC,cAAe,mBAAEJ,qBAAUK,QAAQC,SAASH,KAAK,YAEnDG,gDACU,CAAEF,aAAAA,aAAcL,WAAAA,WAAYO,QAAAA,UACrCyB,MAAMxB,UACDA,SAASyB,OACJlC,WAEFmC,sBAAaN,UAAUpB,YAE/B2B,KAAKD,sBAAaN,+BACnB3B,qBAAU4B,eAAeC,IAAI"}