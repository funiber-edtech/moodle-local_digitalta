{"version":3,"file":"comments.min.js","sources":["../../src/reactions/comments.js"],"sourcesContent":["import $ from \"jquery\";\r\nimport Template from \"core/templates\";\r\nimport Notification from \"core/notification\";\r\nimport { SELECTORS } from \"./selectors\";\r\nimport { addComment, getComments } from \"../repositories/reactions_repository\";\r\n\r\n/**\r\n * Send the comment to the server.\r\n * @return {void}\r\n */\r\nexport function sendComment() {\r\n    const component = $(SELECTORS.BUTTONS.comment).data(\"component\");\r\n    const componentinstance = $(SELECTORS.ACTIONS.sendComment).data(\"id\");\r\n    const comment = $(SELECTORS.COMMENTS.input).val().trim();\r\n\r\n    if (comment) {\r\n        addComment({ component, componentinstance, comment })\r\n            .then((response) => {\r\n                if (response.result) {\r\n                    return updateUI();\r\n                }\r\n                return Notification.exception(response);\r\n            })\r\n            .fail(Notification.exception);\r\n        $(SELECTORS.COMMENTS.input).val(\"\");\r\n    }\r\n}\r\n\r\n/**\r\n * Update the comments in the UI.\r\n * @return {void}\r\n */\r\nexport async function updateUI() {\r\n    const component = $(SELECTORS.BUTTONS.comment).data(\"component\");\r\n    const componentinstance = $(SELECTORS.ACTIONS.sendComment).data(\"id\");\r\n    if (!componentinstance) {\r\n        return;\r\n    }\r\n    try {\r\n        const response = await getComments({ component, componentinstance });\r\n        let comments = [];\r\n        if (response.result && response.comments) {\r\n            comments = response.comments.map((comment) => ({\r\n                comment: comment.comment,\r\n                userfullname: comment.user.fullname,\r\n                userprofileurl: M.cfg.wwwroot + \"/user/profile.php?id=\" + comment.user.id,\r\n            }));\r\n        }\r\n        const html = await Template.render(\"local_dta/reactions/comments\", { comments });\r\n        $(SELECTORS.COMMENTS.list).html(html);\r\n        const button = $(SELECTORS.ACTIONS.viewComment + SELECTORS.DATA.id(componentinstance));\r\n              button.toggleClass(\"active\", button.hasClass(\"show\"));\r\n        $(SELECTORS.ACTIONS.viewComment + SELECTORS.DATA.id(componentinstance) + \" span\").text(\r\n            comments.length ? comments.length : \"\"\r\n        );\r\n    } catch (error) {\r\n        Notification.exception(error);\r\n    }\r\n}\r\n"],"names":["updateUI","component","SELECTORS","BUTTONS","comment","data","componentinstance","ACTIONS","sendComment","response","comments","result","map","userfullname","user","fullname","userprofileurl","M","cfg","wwwroot","id","html","Template","render","COMMENTS","list","button","viewComment","DATA","toggleClass","hasClass","text","length","error","exception","input","val","trim","then","Notification","fail"],"mappings":"4UAgCsBA,iBACZC,WAAY,mBAAEC,qBAAUC,QAAQC,SAASC,KAAK,aAC9CC,mBAAoB,mBAAEJ,qBAAUK,QAAQC,aAAaH,KAAK,SAC3DC,4BAIKG,eAAiB,qCAAY,CAAER,UAAAA,UAAWK,kBAAAA,wBAC5CI,SAAW,GACXD,SAASE,QAAUF,SAASC,WAC5BA,SAAWD,SAASC,SAASE,KAAKR,WAC9BA,QAASA,QAAQA,QACjBS,aAAcT,QAAQU,KAAKC,SAC3BC,eAAgBC,EAAEC,IAAIC,QAAU,wBAA0Bf,QAAQU,KAAKM,cAGzEC,WAAaC,mBAASC,OAAO,+BAAgC,CAAEb,SAAAA,+BACnER,qBAAUsB,SAASC,MAAMJ,KAAKA,YAC1BK,QAAS,mBAAExB,qBAAUK,QAAQoB,YAAczB,qBAAU0B,KAAKR,GAAGd,oBAC7DoB,OAAOG,YAAY,SAAUH,OAAOI,SAAS,6BACjD5B,qBAAUK,QAAQoB,YAAczB,qBAAU0B,KAAKR,GAAGd,mBAAqB,SAASyB,KAC9ErB,SAASsB,OAAStB,SAASsB,OAAS,IAE1C,MAAOC,6BACQC,UAAUD,sGA7CrBhC,WAAY,mBAAEC,qBAAUC,QAAQC,SAASC,KAAK,aAC9CC,mBAAoB,mBAAEJ,qBAAUK,QAAQC,aAAaH,KAAK,MAC1DD,SAAU,mBAAEF,qBAAUsB,SAASW,OAAOC,MAAMC,OAE9CjC,+CACW,CAAEH,UAAAA,UAAWK,kBAAAA,kBAAmBF,QAAAA,UACtCkC,MAAM7B,UACCA,SAASE,OACFX,WAEJuC,sBAAaL,UAAUzB,YAEjC+B,KAAKD,sBAAaL,+BACrBhC,qBAAUsB,SAASW,OAAOC,IAAI"}