define("local_dta/reactions/comments",["exports","jquery","core/templates","core/notification","./selectors","../repositories/reactions_repository"],(function(_exports,_jquery,_templates,_notification,_selectors,_reactions_repository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}async function updateUI(){const instanceid=(0,_jquery.default)(_selectors.SELECTORS.ACTIONS.sendComment).data("id"),instancetype=(0,_jquery.default)(_selectors.SELECTORS.BUTTONS.comment).data("instance");if(instanceid)try{const response=await(0,_reactions_repository.getComments)({instanceid:instanceid,instancetype:instancetype}),comments=response.comments.map((comment=>({comment:comment.comment,userfullname:comment.user.fullname,userprofileUrl:M.cfg.wwwroot+"/user/profile.php?id="+comment.user.id}))),html=await _templates.default.render("local_dta/reactions/comments",{comments:comments});(0,_jquery.default)(_selectors.SELECTORS.COMMENTS_LIST).html(html),(0,_jquery.default)(_selectors.SELECTORS.ACTIONS.viewComment+_selectors.SELECTORS.DATA.id(instanceid)+" span").text(response.comments.length?response.comments.length:"")}catch(error){_notification.default.exception(error)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.sendComment=function(){const comment=(0,_jquery.default)(_selectors.SELECTORS.COMMENT_INPUT).val().trim(),instanceid=(0,_jquery.default)(_selectors.SELECTORS.ACTIONS.sendComment).data("id"),instancetype=(0,_jquery.default)(_selectors.SELECTORS.BUTTONS.comment).data("instance");comment&&((0,_reactions_repository.saveComment)({instancetype:instancetype,instanceid:instanceid,comment:comment}).then((response=>response.result?updateUI():_notification.default.exception(response))).fail(_notification.default.exception),(0,_jquery.default)(_selectors.SELECTORS.COMMENT_INPUT).val(""))},_exports.updateUI=updateUI,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification)}));

//# sourceMappingURL=comments.min.js.map