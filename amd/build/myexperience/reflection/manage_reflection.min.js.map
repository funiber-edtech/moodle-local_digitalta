{"version":3,"file":"manage_reflection.min.js","sources":["../../../src/myexperience/reflection/manage_reflection.js"],"sourcesContent":["import $ from \"jquery\";\r\nimport ModalFactory from \"core/modal_factory\";\r\nimport ModalEvents from 'core/modal_events';\r\nimport Templates from \"core/templates\";\r\nimport { get_string } from \"core/str\";\r\nimport { setupForElementId } from \"editor_tiny/editor\";\r\nimport { sectionTextUpsert } from \"local_dta/repositories/reflection_repository\";\r\nimport Notification from \"core/notification\";\r\nimport { getCases } from \"../../repositories/reflection_repository\";\r\n\r\nlet tinyConfig;\r\n\r\n/**\r\n * Create tinyMCE in an area.\r\n * @param {string} area - The id of the area to create tinyMCE in.\r\n * @return {void}\r\n */\r\nfunction createTinyMCE(area) {\r\n  setupForElementId({\r\n    elementId: `${area}`,\r\n    options: tinyConfig,\r\n  });\r\n}\r\n\r\n/**\r\n * Set event listeners for the module.\r\n * @return {void}\r\n * */\r\nfunction setDefaultTinyMCE() {\r\n  $(\".editor\").each(function () {\r\n    createTinyMCE(this.id);\r\n  });\r\n}\r\n\r\n/**\r\n * Set the tinyMCE config.\r\n * @return {void}\r\n */\r\nfunction setTinyConfig() {\r\n  tinyConfig = window.dta_tiny_config;\r\n}\r\n\r\n/**\r\n * Save the text section.\r\n * @param {object} btn - The data to save.\r\n * @return {void}\r\n */\r\nfunction saveTextSection(btn) {\r\n  const data = btn.data();\r\n  const { target, group, id } = data;\r\n  const reflectionid = $(\"#reflectionid\").val();\r\n  const content = window.tinyMCE.get(target).getContent();\r\n  sectionTextUpsert({ reflectionid, group, content, id })\r\n    .then(() => {\r\n      Notification.addNotification({\r\n        message: \"Section saved successfully.\",\r\n        type: \"success\",\r\n      });\r\n      return;\r\n    })\r\n    .fail(Notification.exception);\r\n}\r\n\r\n/**\r\n * Show save case modal\r\n * @return {void}\r\n */\r\nasync function showImportCase() {\r\n  const cases = await getCases();\r\n  const saveModal = await ModalFactory.create({\r\n    type: ModalFactory.types.SAVE_CANCEL,\r\n    title: get_string(\"experience_reflection_import_cases_title\", \"local_dta\"),\r\n    body: Templates.render(\"local_dta/experiences/manage/import-case-modal\", { cases }),\r\n  });\r\n  saveModal.setSaveButtonText(\"Import\");\r\n\r\n  saveModal.getRoot().on(ModalEvents.save, () => {\r\n    const caseIds = [];\r\n    const selectedCases = saveModal.getRoot().find(\"input:checked\");\r\n    selectedCases.each(function () {\r\n      caseIds.push($(this).val());\r\n    });\r\n    saveModal.hide();\r\n    //eslint-disable-next-line no-console\r\n    console.log(caseIds);\r\n  }\r\n  );\r\n\r\n  saveModal.show();\r\n}\r\n\r\n/**\r\n * Activate the step.\r\n * @param {number} stepNum - The step number to activate.\r\n * @return {void}\r\n * */\r\nfunction activateStep(stepNum = 1) {\r\n  const steps = $(\"#stepbar\").find(\"li\");\r\n\r\n  // Change the active step\r\n  for (let i = 0; i < steps.length; i++) {\r\n    if (i < stepNum) {\r\n      $(steps[i]).addClass(\"active\");\r\n    } else {\r\n      $(steps[i]).removeClass(\"active\");\r\n    }\r\n  }\r\n\r\n  // Change the active section\r\n  switch (stepNum) {\r\n    case 1:\r\n      showSection(\"what\");\r\n      break;\r\n    case 2:\r\n      showSection(\"so_what\");\r\n      break;\r\n    case 3:\r\n      showSection(\"now_what\");\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Show the section.\r\n * @param {string} section - The section to show.\r\n * @return {void}\r\n * */\r\nfunction showSection(section = \"what\") {\r\n  const sections = $(\".sections\").find(\".section\");\r\n\r\n  sections.each(function () {\r\n    const sectionId = $(this).attr(\"id\");\r\n    if (sectionId === `section_${section}`) {\r\n      $(this).addClass(\"active\");\r\n      $(this).addClass(\"d-flex\").removeClass(\"d-none\");\r\n    } else {\r\n      $(this).removeClass(\"active\");\r\n      $(this).addClass(\"d-none\").removeClass(\"d-flex\");\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Set event listeners for the module.\r\n * @return {void}\r\n * */\r\nfunction setEventListeners() {\r\n  // Save section\r\n  $(document).on(\"click\", \".submit\", function () {\r\n    saveTextSection($(this));\r\n  });\r\n\r\n  // Add-Section-Menu Collapse\r\n  $(document).on(\"click\", \"#add_button\", function () {\r\n    const importerParent = $(this).closest(\"#importer\");\r\n    const importerDiv = importerParent.find(\"#import_div\");\r\n    const addIcon = $(this).find(\"i\");\r\n    // importerDiv.css('display', importerDiv.css('display') == 'flex' ? 'none' : 'flex');\r\n    if (importerParent.hasClass(\"collapsed\")) {\r\n      importerParent.removeClass(\"collapsed\");\r\n      importerDiv.css(\"display\", \"flex\");\r\n      addIcon.removeClass(\"fa fa-plus-circle\").addClass(\"fa fa-minus-circle\");\r\n    } else {\r\n      importerParent.addClass(\"collapsed\");\r\n      importerDiv.hide();\r\n      addIcon.removeClass(\"fa fa-minus-circle\").addClass(\"fa fa-plus-circle\");\r\n    }\r\n  });\r\n\r\n  // Change Section\r\n  $(document).on(\"click\", \"#btn_what\", function () {\r\n    activateStep();\r\n  });\r\n\r\n  $(document).on(\"click\", \"#btn_so_what\", function () {\r\n    activateStep(2);\r\n  });\r\n\r\n  $(document).on(\"click\", \"#btn_now_what\", function () {\r\n    activateStep(3);\r\n  });\r\n\r\n  // Import Buttons\r\n  $(document).on(\"click\", \".import_button\", function () {\r\n    const buttonId = $(this).attr(\"id\");\r\n\r\n    switch (buttonId) {\r\n      case \"import_cases\":\r\n        showImportCase();\r\n        break;\r\n      case \"import_resources\":\r\n        //eslint-disable-next-line no-console\r\n        console.log(\"Import Resources\");\r\n        break;\r\n    }\r\n  });\r\n\r\n  // on LOAD - ready is deprecated\r\n  $(function () {\r\n    activateStep();\r\n  });\r\n}\r\n\r\nexport const init = () => {\r\n  setEventListeners();\r\n  setTinyConfig();\r\n  setDefaultTinyMCE();\r\n};\r\n"],"names":["tinyConfig","setDefaultTinyMCE","each","area","this","id","elementId","options","activateStep","stepNum","steps","find","i","length","addClass","removeClass","showSection","section","sections","attr","setEventListeners","document","on","btn","data","target","group","reflectionid","val","content","window","tinyMCE","get","getContent","then","addNotification","message","type","fail","Notification","exception","saveTextSection","importerParent","closest","importerDiv","addIcon","hasClass","css","hide","cases","saveModal","ModalFactory","create","types","SAVE_CANCEL","title","body","Templates","render","setSaveButtonText","getRoot","ModalEvents","save","caseIds","push","console","log","show","showImportCase","dta_tiny_config"],"mappings":"8fAUIA,oBAkBKC,wCACL,WAAWC,MAAK,eAZGC,KAAAA,KAaLC,KAAKC,iCAZH,CAChBC,oBAAcH,MACdI,QAASP,yBA4EJQ,mBAAaC,+DAAU,QACxBC,OAAQ,mBAAE,YAAYC,KAAK,UAG5B,IAAIC,EAAI,EAAGA,EAAIF,MAAMG,OAAQD,IAC5BA,EAAIH,4BACJC,MAAME,IAAIE,SAAS,8BAEnBJ,MAAME,IAAIG,YAAY,iBAKpBN,cACD,EACHO,YAAY,mBAET,EACHA,YAAY,sBAET,EACHA,YAAY,sBAUTA,kBAAYC,+DAAU,aACvBC,UAAW,mBAAE,aAAaP,KAAK,YAErCO,SAAShB,MAAK,YACM,mBAAEE,MAAMe,KAAK,0BACFF,8BACzBb,MAAMU,SAAS,8BACfV,MAAMU,SAAS,UAAUC,YAAY,gCAErCX,MAAMW,YAAY,8BAClBX,MAAMU,SAAS,UAAUC,YAAY,uBASpCK,wCAELC,UAAUC,GAAG,QAAS,WAAW,qBArGZC,WACjBC,KAAOD,IAAIC,QACXC,OAAEA,OAAFC,MAAUA,MAAVrB,GAAiBA,IAAOmB,KACxBG,cAAe,mBAAE,iBAAiBC,MAClCC,QAAUC,OAAOC,QAAQC,IAAIP,QAAQQ,0DACzB,CAAEN,aAAAA,aAAcD,MAAAA,MAAOG,QAAAA,QAASxB,GAAAA,KAC/C6B,MAAK,2BACSC,gBAAgB,CAC3BC,QAAS,8BACTC,KAAM,eAITC,KAAKC,sBAAaC,WAyFnBC,EAAgB,mBAAErC,8BAIlBiB,UAAUC,GAAG,QAAS,eAAe,iBAC/BoB,gBAAiB,mBAAEtC,MAAMuC,QAAQ,aACjCC,YAAcF,eAAe/B,KAAK,eAClCkC,SAAU,mBAAEzC,MAAMO,KAAK,KAEzB+B,eAAeI,SAAS,cAC1BJ,eAAe3B,YAAY,aAC3B6B,YAAYG,IAAI,UAAW,QAC3BF,QAAQ9B,YAAY,qBAAqBD,SAAS,wBAElD4B,eAAe5B,SAAS,aACxB8B,YAAYI,OACZH,QAAQ9B,YAAY,sBAAsBD,SAAS,6CAKrDO,UAAUC,GAAG,QAAS,aAAa,WACnCd,sCAGAa,UAAUC,GAAG,QAAS,gBAAgB,WACtCd,aAAa,0BAGba,UAAUC,GAAG,QAAS,iBAAiB,WACvCd,aAAa,0BAIba,UAAUC,GAAG,QAAS,kBAAkB,mBACvB,mBAAElB,MAAMe,KAAK,WAGvB,uCAvHH8B,YAAc,sCACdC,gBAAkBC,uBAAaC,OAAO,CAC1Cf,KAAMc,uBAAaE,MAAMC,YACzBC,OAAO,mBAAW,2CAA4C,aAC9DC,KAAMC,mBAAUC,OAAO,iDAAkD,CAAET,MAAAA,UAE7EC,UAAUS,kBAAkB,UAE5BT,UAAUU,UAAUtC,GAAGuC,sBAAYC,MAAM,WACjCC,QAAU,GACMb,UAAUU,UAAUjD,KAAK,iBACjCT,MAAK,WACjB6D,QAAQC,MAAK,mBAAE5D,MAAMwB,UAEvBsB,UAAUF,OAEViB,QAAQC,IAAIH,YAIdb,UAAUiB,OAoGJC,aAEG,mBAEHH,QAAQC,IAAI,6CAMhB,WACA1D,iWAIgB,KAClBY,oBArKApB,WAAa8B,OAAOuC,gBAuKpBpE"}