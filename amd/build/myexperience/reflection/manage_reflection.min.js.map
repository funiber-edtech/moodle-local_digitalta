{"version":3,"file":"manage_reflection.min.js","sources":["../../../src/myexperience/reflection/manage_reflection.js"],"sourcesContent":["import $ from \"jquery\";\r\nimport ModalFactory from \"core/modal_factory\";\r\nimport ModalEvents from 'core/modal_events';\r\nimport Templates from \"core/templates\";\r\nimport { get_string } from \"core/str\";\r\nimport { setupForElementId } from \"editor_tiny/editor\";\r\nimport { sectionTextUpsert } from \"local_dta/repositories/reflection_repository\";\r\nimport Notification from \"core/notification\";\r\nimport { getCases } from \"../../repositories/reflection_repository\";\r\n\r\nlet tinyConfig;\r\n\r\n/**\r\n * Create tinyMCE in an area.\r\n * @param {string} area - The id of the area to create tinyMCE in.\r\n * @return {void}\r\n */\r\nfunction createTinyMCE(area) {\r\n  setupForElementId({\r\n    elementId: `${area}`,\r\n    options: tinyConfig,\r\n  });\r\n}\r\n\r\n/**\r\n * Set event listeners for the module.\r\n * @return {void}\r\n * */\r\nfunction setDefaultTinyMCE() {\r\n  $(\".editor\").each(function () {\r\n    createTinyMCE(this.id);\r\n  });\r\n}\r\n\r\n/**\r\n * Set the tinyMCE config.\r\n * @return {void}\r\n */\r\nfunction setTinyConfig() {\r\n  tinyConfig = window.dta_tiny_config;\r\n}\r\n\r\n/**\r\n * Save the text section.\r\n * @param {object} btn - The data to save.\r\n * @return {void}\r\n */\r\nfunction saveTextSection(btn) {\r\n  const data = btn.data();\r\n  const { target, group, id } = data;\r\n  const reflectionid = $(\"#reflectionid\").val();\r\n  const content = window.tinyMCE.get(target).getContent();\r\n  sectionTextUpsert({ reflectionid, group, content, id })\r\n    .then(() => {\r\n      Notification.addNotification({\r\n        message: \"Section saved successfully.\",\r\n        type: \"success\",\r\n      });\r\n      return;\r\n    })\r\n    .fail(Notification.exception);\r\n}\r\n\r\n/**\r\n * Show save case modal\r\n * @return {void}\r\n */\r\nasync function showImportCase() {\r\n  const cases = await getCases();\r\n  const saveModal = await ModalFactory.create({\r\n    type: ModalFactory.types.SAVE_CANCEL,\r\n    title: get_string(\"experience_reflection_import_cases_title\", \"local_dta\"),\r\n    body: Templates.render(\"local_dta/experiences/manage/import-case-modal\", { cases }),\r\n  });\r\n  saveModal.setSaveButtonText(\"Import\");\r\n\r\n  saveModal.getRoot().on(ModalEvents.save, () => {\r\n    const caseIds = [];\r\n    const selectedCases = saveModal.getRoot().find(\"input:checked\");\r\n    selectedCases.each(function () {\r\n      caseIds.push($(this).val());\r\n    });\r\n    saveModal.hide();\r\n    //eslint-disable-next-line no-console\r\n    console.log(caseIds);\r\n  }\r\n  );\r\n\r\n  saveModal.show();\r\n}\r\n\r\n/**\r\n * Set event listeners for the module.\r\n * @return {void}\r\n * */\r\nfunction setEventListeners() {\r\n  // Save section\r\n  $(document).on(\"click\", \".submit\", function () {\r\n    saveTextSection($(this));\r\n  });\r\n\r\n  // Collapse Sections\r\n  $(document).on(\"click\", \".header\", function () {\r\n    const section = $(this).closest(\".section\");\r\n    const content = section.find(\".questions\");\r\n    const collapseIcon = $(this).find(\"i\");\r\n    if (section.hasClass(\"collapsed\")) {\r\n      section.removeClass(\"collapsed\");\r\n      content.css(\"display\", \"flex\");\r\n      collapseIcon.removeClass(\"fa-chevron-right\").addClass(\"fa-chevron-down\");\r\n    } else {\r\n      section.addClass(\"collapsed\");\r\n      content.hide();\r\n      collapseIcon.removeClass(\"fa-chevron-down\").addClass(\"fa-chevron-right\");\r\n    }\r\n  });\r\n\r\n  // Add-Section-Menu Collapse\r\n  $(document).on(\"click\", \"#add_button\", function () {\r\n    const importerParent = $(this).closest(\"#importer\");\r\n    const importerDiv = importerParent.find(\"#import_div\");\r\n    const addIcon = $(this).find(\"i\");\r\n    // importerDiv.css('display', importerDiv.css('display') == 'flex' ? 'none' : 'flex');\r\n    if (importerParent.hasClass(\"collapsed\")) {\r\n      importerParent.removeClass(\"collapsed\");\r\n      importerDiv.css(\"display\", \"flex\");\r\n      addIcon.removeClass(\"fa fa-plus-circle\").addClass(\"fa fa-minus-circle\");\r\n    } else {\r\n      importerParent.addClass(\"collapsed\");\r\n      importerDiv.hide();\r\n      addIcon.removeClass(\"fa fa-minus-circle\").addClass(\"fa fa-plus-circle\");\r\n    }\r\n  });\r\n\r\n  // Change Section\r\n  $(document).on(\"click\", \"#btn_what\", function () {\r\n    $(\"#btn_what\").addClass(\"active\");\r\n    $(\"#btn_so_what\").removeClass(\"active\");\r\n    $(\"#btn_now_what\").removeClass(\"active\");\r\n\r\n    $(\"#section_what\").addClass(\"active\");\r\n    $(\"#section_what\").addClass(\"d-flex\").removeClass(\"d-none\");\r\n    $(\"#section_so_what\").removeClass(\"active\");\r\n    $(\"#section_so_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n    $(\"#section_now_what\").removeClass(\"active\");\r\n    $(\"#section_now_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n  });\r\n\r\n  $(document).on(\"click\", \"#btn_so_what\", function () {\r\n    $(\"#btn_what\").addClass(\"active\");\r\n    $(\"#btn_so_what\").addClass(\"active\");\r\n    $(\"#btn_now_what\").removeClass(\"active\");\r\n\r\n    $(\"#section_what\").removeClass(\"active\");\r\n    $(\"#section_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n    $(\"#section_so_what\").addClass(\"active\");\r\n    $(\"#section_so_what\").addClass(\"d-flex\").removeClass(\"d-none\");\r\n    $(\"#section_now_what\").removeClass(\"active\");\r\n    $(\"#section_now_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n  });\r\n\r\n  $(document).on(\"click\", \"#btn_now_what\", function () {\r\n    $(\"#btn_what\").addClass(\"active\");\r\n    $(\"#btn_so_what\").addClass(\"active\");\r\n    $(\"#btn_now_what\").addClass(\"active\");\r\n\r\n    $(\"#section_what\").removeClass(\"active\");\r\n    $(\"#section_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n    $(\"#section_so_what\").removeClass(\"active\");\r\n    $(\"#section_so_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n    $(\"#section_now_what\").addClass(\"active\");\r\n    $(\"#section_now_what\").addClass(\"d-flex\").removeClass(\"d-none\");\r\n  });\r\n\r\n  // Import Buttons\r\n  $(document).on(\"click\", \".import_button\", function () {\r\n    const buttonId = $(this).attr(\"id\");\r\n\r\n    switch (buttonId) {\r\n      case \"tiny\":\r\n        //eslint-disable-next-line no-console\r\n        console.log(\"Tiny\");\r\n        break;\r\n      case \"tiny_record\":\r\n        //eslint-disable-next-line no-console\r\n        console.log(\"Tiny Record\");\r\n        break;\r\n      case \"import_cases\":\r\n        showImportCase();\r\n        break;\r\n      case \"import_experiences\":\r\n        //eslint-disable-next-line no-console\r\n        console.log(\"Import Experiences\");\r\n        break;\r\n      case \"import_tutor_conc\":\r\n        //eslint-disable-next-line no-console\r\n        console.log(\"Import Tutor Conc\");\r\n        break;\r\n      case \"import_resources\":\r\n        //eslint-disable-next-line no-console\r\n        console.log(\"Import Resources\");\r\n        break;\r\n    }\r\n  });\r\n\r\n  // on LOAD - ready is deprecated\r\n  $(function () {\r\n    $(\"#section_what\").addClass(\"active\");\r\n    $(\"#section_what\").addClass(\"d-flex\").removeClass(\"d-none\");\r\n    $(\"#section_so_what\").removeClass(\"active\");\r\n    $(\"#section_so_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n    $(\"#section_now_what\").removeClass(\"active\");\r\n    $(\"#section_now_what\").addClass(\"d-none\").removeClass(\"d-flex\");\r\n  });\r\n}\r\n\r\nexport const init = () => {\r\n  setEventListeners();\r\n  setTinyConfig();\r\n  setDefaultTinyMCE();\r\n};\r\n"],"names":["tinyConfig","setDefaultTinyMCE","each","area","this","id","elementId","options","setEventListeners","document","on","btn","data","target","group","reflectionid","val","content","window","tinyMCE","get","getContent","then","addNotification","message","type","fail","Notification","exception","saveTextSection","section","closest","find","collapseIcon","hasClass","removeClass","css","addClass","hide","importerParent","importerDiv","addIcon","attr","console","log","cases","saveModal","ModalFactory","create","types","SAVE_CANCEL","title","body","Templates","render","setSaveButtonText","getRoot","ModalEvents","save","caseIds","push","show","showImportCase","dta_tiny_config"],"mappings":"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"}