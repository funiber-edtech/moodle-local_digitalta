{"version":3,"file":"form.min.js","sources":["../../../src/experiences/manage/form.js"],"sourcesContent":["import $ from \"jquery\";\nimport Notification from \"core/notification\";\nimport { createTinyMCE, getTinyMCEContent } from \"./../../tiny/manage\";\nimport { setEventListeners } from \"./listeners\";\nimport { activateStep } from \"./steps\";\nimport { experienceUpsert } from \"local_dta/repositories/experience_repository\";\nimport { autocompleteTags } from \"local_dta/tags/autocomplete\";\nimport { saveFiles, init as fileManagerInit } from \"../../files/filemanager\";\n\n/**\n * Set event listeners for the module.\n * @return {void}\n * */\nfunction setDefaultTinyMCE() {\n  $(\".editor\").each(function() {\n    createTinyMCE(this.id);\n  });\n}\n\n/**\n * Collapse the add section menu.\n * @return {void}\n */\nexport function collapseAddSectionMenu() {\n  const importerParent = $(this).closest(\"#importer\");\n  const importerDiv = importerParent.find(\"#import_div\");\n  const addIcon = $(this).find(\"i\");\n  if (importerParent.hasClass(\"collapsed\")) {\n    importerParent.removeClass(\"collapsed\");\n    importerDiv.css(\"display\", \"flex\");\n    addIcon.removeClass(\"fa fa-plus-circle\").addClass(\"fa fa-minus-circle\");\n  } else {\n    importerParent.addClass(\"collapsed\");\n    importerDiv.hide();\n    addIcon.removeClass(\"fa fa-minus-circle\").addClass(\"fa fa-plus-circle\");\n  }\n}\n\n/**\n * Save the text section.\n * @param {object} btn - The data to save.\n * @param {number} step - The step to activate.\n * @return {void}\n */\nexport function saveTextSection(btn, step) {\n  const data = btn.data();\n  const { target, group } = data;\n  const reflectionid = $(\"#reflectionid\").val();\n  const content = getTinyMCEContent(target);\n\n  //sectionTextUpsert({ reflectionid, group, content })\n  //  .then(() => {\n  //    Notification.addNotification({\n  //      message: \"Section saved successfully.\",\n  //      type: \"success\",\n  //    });\n  //    if (step === 3) {\n  //      window.location.href = \"./view.php?id=\" + $(\"#experience_id\").val();\n  //    }\n  //    activateStep(step + 1);\n  //    return;\n  //  })\n  //  .fail(Notification.exception);\n}\n\n/**\n * Show save case modal\n * @return {void}\n */\n// async function showImportCase() {\n//   const cases = await getCases();\n//   const saveModal = await ModalFactory.create({\n//     type: ModalFactory.types.SAVE_CANCEL,\n//     title: get_string(\"experience_reflection_import_cases_title\", \"local_dta\"),\n//     body: Templates.render(\"local_dta/experiences/manage/import-case-modal\", { cases }),\n//   });\n//   saveModal.setSaveButtonText(\"Import\");\n\n//   saveModal.getRoot().on(ModalEvents.save, () => {\n//     const caseIds = [];\n//     const selectedCases = saveModal.getRoot().find(\"input:checked\");\n//     selectedCases.each(function () {\n//       caseIds.push($(this).val());\n//     });\n//     saveModal.hide();\n//     //eslint-disable-next-line no-console\n//     console.log(caseIds);\n//   }\n//   );\n\n//   saveModal.show();\n// }\n\n/**\n * Save the experience.\n * @return {void}\n * */\nexport async function saveExperience() {\n  const experienceTitle = $(\"#experience_title\").val(),\n    experienceVisibility = $(\"#experience_visibility\").val(),\n    experienceLang = $(\"#experience_lang\").val(),\n    experienceid = $(\"#experience_id\").val(),\n    tags = $(\"#autocomplete_tags\").val();\n\n    try {\n      const response = await experienceUpsert({\n        id: experienceid ? experienceid : 0,\n        title: experienceTitle,\n        lang: experienceLang,\n        visible: experienceVisibility,\n        status: 0,\n        tags,\n      });\n\n      await saveFiles(\"featurePicture\", \"fileManager\", response.experienceid, \"experience_picture\");\n      Notification.addNotification({\n        message: \"Experience saved successfully.\",\n        type: \"success\",\n      });\n\n      activateStep(2);\n      $(\"#reflectionid\").val(response.reflectionid);\n      $(\"#experience_id\").val(response.experienceid);\n    } catch (error) {\n      Notification.exception(error);\n    }\n}\n\nexport const init = () => {\n  fileManagerInit(\"featurePicture\");\n  setDefaultTinyMCE();\n  autocompleteTags(\"#autocomplete_tags\");\n  activateStep();\n  setEventListeners();\n};\n"],"names":["importerParent","this","closest","importerDiv","find","addIcon","hasClass","removeClass","css","addClass","hide","experienceTitle","val","experienceVisibility","experienceLang","experienceid","tags","response","id","title","lang","visible","status","addNotification","message","type","reflectionid","error","exception","btn","step","data","target","group","each"],"mappings":"0hBAwBQA,gBAAiB,mBAAEC,MAAMC,QAAQ,aACjCC,YAAcH,eAAeI,KAAK,eAClCC,SAAU,mBAAEJ,MAAMG,KAAK,KACzBJ,eAAeM,SAAS,cAC1BN,eAAeO,YAAY,aAC3BJ,YAAYK,IAAI,UAAW,QAC3BH,QAAQE,YAAY,qBAAqBE,SAAS,wBAElDT,eAAeS,SAAS,aACxBN,YAAYO,OACZL,QAAQE,YAAY,sBAAsBE,SAAS,2FAgE/CE,iBAAkB,mBAAE,qBAAqBC,MAC7CC,sBAAuB,mBAAE,0BAA0BD,MACnDE,gBAAiB,mBAAE,oBAAoBF,MACvCG,cAAe,mBAAE,kBAAkBH,MACnCI,MAAO,mBAAE,sBAAsBJ,gBAGvBK,eAAiB,2CAAiB,CACtCC,GAAIH,cAA8B,EAClCI,MAAOR,gBACPS,KAAMN,eACNO,QAASR,qBACTS,OAAQ,EACRN,KAAAA,aAGI,0BAAU,iBAAkB,cAAeC,SAASF,aAAc,4CAC3DQ,gBAAgB,CAC3BC,QAAS,iCACTC,KAAM,oCAGK,uBACX,iBAAiBb,IAAIK,SAASS,kCAC9B,kBAAkBd,IAAIK,SAASF,cACjC,MAAOY,6BACMC,UAAUD,2CAhFGE,IAAKC,YAC7BC,KAAOF,IAAIE,QACXC,OAAEA,OAAFC,MAAUA,OAAUF,MACL,mBAAE,iBAAiBnB,OACxB,6BAAkBoB,mHAgFhB,2BACF,sCAnHd,WAAWE,MAAK,qCACFjC,KAAKiB,0CAoHJ"}