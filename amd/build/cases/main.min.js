define("local_digitalta/cases/main",["exports","jquery","core/templates","core/notification","local_digitalta/repositories/cases_repository","local_digitalta/repositories/sections_repository","local_digitalta/cases/listeners","local_digitalta/tiny/manage","local_digitalta/tags/autocomplete","local_digitalta/themes/autocomplete","local_digitalta/cases/selectors"],(function(_exports,_jquery,_templates,_notification,_cases_repository,_sections_repository,_listeners,_manage,_autocomplete,_autocomplete2,_selectors){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.validateFormData=_exports.switchSectionEdition=_exports.saveSection=_exports.init=_exports.deleteSection=_exports.changeStatusToComplete=_exports.addSection=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_listeners=_interopRequireDefault(_listeners),_selectors=_interopRequireDefault(_selectors);let urlView=null;_exports.addSection=(caseid,typename)=>{const formData={id:null,component:"case",componentinstance:caseid,groupid:null,groupname:"General",sequence:null,type:null,typename:typename,title:null,content:null};(0,_sections_repository.sectionsUpsert)(formData).then((data=>{_templates.default.render("local_digitalta/cases/manage/manage-section-text-edit",{id:data.sectionid,title:null,content:null}).then((html=>{(0,_jquery.default)(_selectors.default.SECTIONS.sections).append(html),(0,_manage.createTinyMCE)("content_".concat(data.sectionid))})).fail(_notification.default.exception)})).fail(_notification.default.exception)};const switchSectionEdition=function(sectionid){let toEdit=arguments.length>1&&void 0!==arguments[1]&&arguments[1],title=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,content=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise(((resolve,reject)=>{const template=toEdit?"local_digitalta/cases/manage/manage-section-text-edit":"local_digitalta/cases/manage/manage-section-text-view";_templates.default.render(template,{id:sectionid,title:title,content:content}).then((html=>(toEdit||(0,_manage.removeTinyMCEFromArea)("content_".concat(sectionid)),(0,_jquery.default)("#section_".concat(sectionid)).replaceWith(html),toEdit&&(0,_manage.createTinyMCE)("content_".concat(sectionid)),resolve()))).fail((error=>{reject(error),_notification.default.exception(error)}))}))};_exports.switchSectionEdition=switchSectionEdition;_exports.saveSection=(caseid,sectionid)=>{const formData={id:sectionid,component:"case",componentinstance:caseid,groupid:null,groupname:"General",sequence:null,type:null,typename:"text",title:(0,_jquery.default)("#title_".concat(sectionid)).val(),content:(0,_manage.getTinyMCEContent)("content_".concat(sectionid))};(0,_sections_repository.sectionsUpsert)(formData).then((data=>{switchSectionEdition(data.sectionid,!1,formData.title,formData.content)})).fail(_notification.default.exception)};_exports.deleteSection=sectionid=>{(0,_sections_repository.sectionsDelete)({id:sectionid}).then((data=>{data.result&&(0,_jquery.default)("#section_".concat(sectionid)).remove()})).fail(_notification.default.exception)};_exports.changeStatusToComplete=async()=>{const form=document.querySelector("#case-manage-form"),formData={id:form.querySelector('input[name="case-id"]').value,title:form.querySelector('input[name="case-manage-title"]').value,description:(0,_manage.getTinyMCEContent)("case-manage-description"),lang:form.querySelector('select[name="case-manage-lang"]').value,status:parseInt(1),themes:Array.from(form.querySelectorAll('select[name="case-manage-themes"] option:checked'),(option=>option.value)),tags:Array.from(form.querySelectorAll('select[name="case-manage-tags"] option:checked'),(option=>option.value))};try{const response=await(0,_cases_repository.casesEdit)(formData);_notification.default.addNotification({message:"Case updated successfully",type:"success"}),location.href=urlView+response.caseid}catch(error){_notification.default.exception(error)}};_exports.validateFormData=()=>{let error=!1;(0,_jquery.default)([_selectors.default.SECTIONS.formDataError,_selectors.default.SECTIONS.errorMissingRequiredFields,_selectors.default.SECTIONS.errorEditingSections].join(", ")).hide();const form=document.getElementById(_selectors.default.SECTIONS.form.replace("#",""));return validateManageRequiredFields(form)||((0,_jquery.default)(_selectors.default.SECTIONS.errorMissingRequiredFields).show(),error=!0),validateManageEditingSections()||((0,_jquery.default)(_selectors.default.SECTIONS.errorEditingSections).show(),error=!0),!error||((0,_jquery.default)(_selectors.default.SECTIONS.formDataError).show(),!1)};const validateManageRequiredFields=form=>{const requiredFields=form.querySelectorAll("input[required], select[required], textarea[required]");for(const field of requiredFields)if(!field.value)return!1;return!0},validateManageEditingSections=()=>!document.querySelectorAll(".case-manage-section-edit").length;_exports.init=async dataUrlView=>{urlView=dataUrlView,(0,_listeners.default)(),(0,_autocomplete.autocompleteTags)("#case-manage-tags"),(0,_autocomplete2.autocompleteThemes)("#case-manage-themes"),(0,_manage.createTinyMCE)("case-manage-description")}}));

//# sourceMappingURL=main.min.js.map